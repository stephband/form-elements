/* form-elements 
   0.0.4
   By Stephen Band
   Built 2022-11-09 12:18 */

var Fe=Object.getOwnPropertySymbols;var ri=Object.prototype.hasOwnProperty,si=Object.prototype.propertyIsEnumerable;var De=(t,e)=>{var i={};for(var o in t)ri.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(t!=null&&Fe)for(var o of Fe(t))e.indexOf(o)<0&&si.call(t,o)&&(i[o]=t[o]);return i};function b(t){return t}function v(t,e){return function(){let o=t.apply(this,arguments),r=e[o]||e.default;if(!r)throw new Error('overload() no handler for "'+o+'"');return r.apply(this,arguments)}}function Q(t){var e=new Map;return function(o){if(e.has(o))return e.get(o);var r=t(o);return e.set(o,r),r}}var ui=Array.prototype;function ai(t,e){return typeof t=="function"?t.apply(null,e):t}function Ve(t,e,i){i=i||t.length;var o=i===1?e?t:Q(t):Q(function(r){return Ve(function(){var s=[r];return s.push.apply(s,arguments),t.apply(null,s)},e,i-1)});return function r(s){return arguments.length===0?r:arguments.length===1?o(s):arguments.length>=i?t.apply(null,arguments):ai(o(s),ui.slice.call(arguments,1))}}var E=Ve;function P(){}var li=v(b,{is:P,tag:P,data:function(t,e,i){Object.assign(e.dataset,i)},html:function(t,e,i){e.innerHTML=i},text:function(t,e,i){e.textContent=i},children:function(t,e,i){e.innerHTML="",e.append.apply(e,i)},points:q,cx:q,cy:q,r:q,transform:q,preserveAspectRatio:q,viewBox:q,default:function(t,e,i){t in e?e[t]=i:e.setAttribute(t,i)}});function q(t,e,i){e.setAttribute(t,i)}function pi(t,e){for(var i=Object.keys(e),o=i.length;o--;)li(i[o],t,e[i[o]]);return t}var wt=E(pi,!0);var Nt="http://www.w3.org/2000/svg",He=document.createElement("template"),qt=(t,e)=>e&&typeof e;function je(t,e){let i=document.createRange();return i.selectNode(t),i.createContextualFragment(e)}var O=v(qt,{string:function(t,e){let i=document.createElementNS(Nt,t);return i.innerHTML=e,i},object:function(t,e){let i=document.createElementNS(Nt,t);return typeof e.length=="number"?i.append.apply(i,e):wt(i,e),i},default:t=>document.createElementNS(Nt,t)}),ci=v(qt,{string:function(t,e){let i=document.createElement(t);return i.innerHTML=e,i},object:function(t,e){let i=document.createElement(t);return typeof e.length=="number"?i.append.apply(i,e):wt(i,e),i},default:t=>document.createElement(t)}),hi=v(b,{comment:function(t,e){return document.createComment(e||"")},fragment:v(qt,{string:function(t,e,i){return i?je(i,e):(He.innerHTML=e,He.content.cloneNode(!0))},object:function(t,e,i){let o=i?je(i):document.createDocumentFragment();return typeof e.length=="number"?o.append.apply(o,e):wt(o,e),o},default:()=>document.createDocumentFragment()}),text:function(t,e){return document.createTextNode(e||"")},circle:O,ellipse:O,g:O,glyph:O,image:O,line:O,rect:O,use:O,path:O,pattern:O,polygon:O,polyline:O,svg:O,default:ci}),C=hi;function Yt(t,e,i){let o;typeof i!="string"&&i.input!==void 0&&i.index!==void 0&&(o=i,i=o.input.slice(i.index+i[0].length+(i.consumed||0)));let r=t.exec(i);if(!r)return;let s=e(r);return o&&(o.consumed=(o.consumed||0)+r.index+r[0].length+(r.consumed||0)),s}var yr=E(Yt,!0);function fi(t,e,i){throw i.input!==void 0&&i.index!==void 0&&(i=i.input),new Error('Cannot parse string "'+(i.length>128?i.length.slice(0,128)+"…":i)+'"')}function mi(t,e,i){let o=-1;for(;++o<i.length;)e=i[o]!==void 0&&t[o]?t[o](e,i):e;return t.done?t.done(e,i):t.close?t.close(e,i):e}function di(t,e,i,o){let r=Yt(t,s=>mi(e,i,s),o);return r===void 0?e.catch?e.catch(i,o):fi(t,e,o):r}var Ie=E(di,!0);var A=Symbol("internals"),Y=Symbol("shadow"),Ge=Object.defineProperties,gi={a:HTMLAnchorElement,article:HTMLElement,dl:HTMLDListElement,p:HTMLParagraphElement,br:HTMLBRElement,fieldset:HTMLFieldSetElement,hr:HTMLHRElement,img:HTMLImageElement,li:HTMLLIElement,ol:HTMLOListElement,optgroup:HTMLOptGroupElement,q:HTMLQuoteElement,section:HTMLElement,textarea:HTMLTextAreaElement,td:HTMLTableCellElement,th:HTMLTableCellElement,tr:HTMLTableRowElement,tbody:HTMLTableSectionElement,thead:HTMLTableSectionElement,tfoot:HTMLTableSectionElement,ul:HTMLUListElement},wi={name:{set:function(t){return this.setAttribute("name",t)},get:function(){return this.getAttribute("name")||""}},form:{get:function(){return this[A].form}},labels:{get:function(){return this[A].labels}},validity:{get:function(){return this[A].validity}},validationMessage:{get:function(){return this[A].validationMessage}},willValidate:{get:function(){return this[A].willValidate}},checkValidity:{value:function(){return this[A].checkValidity()}},reportValidity:{value:function(){return this[A].reportValidity()}}},yi={},Re={once:!0},ze=0,_e=!1;function vi(t){return gi[t]||window["HTML"+t[0].toUpperCase()+t.slice(1)+"Element"]||(()=>{throw new Error('Constructor not found for tag "'+t+'"')})()}var Ti=Ie(/^\s*<?([a-z][\w]*-[\w-]+)>?\s*$|^\s*<?([a-z][\w]*)\s+is[=\s]*["']?([a-z][\w]*-[\w]+)["']?>?\s*$/,{1:(t,e)=>({name:e[1]}),2:(t,e)=>({name:e[3],tag:e[2]}),catch:function(t,e){throw new SyntaxError(`dom element() – name must be of the form 'element-name' or 'tag is="element-name"' (`+e+")")}},null);function bi(t,e){if(t.hasOwnProperty(e)){let i=t[e];delete t[e],t[e]=i}return t}function Ue(t,e,i){t._initialLoad=!0;let o=t.attachShadow({mode:e.mode||"closed",delegatesFocus:e.focusable||!1});if(i){let r=C("link",{rel:"stylesheet",href:i});o.append(r)}return t[Y]=o,o}function Ei(t){var e;if(t.attachInternals){if(e=t.attachInternals(),e.setFormValue)return e}else e={shadowRoot:t.shadowRoot};return e.input=C("input",{type:"hidden",name:t.name}),t.appendChild(e.input),e.setFormValue=function(i){this.input.value=i},e}function Si(t){return!!t.attribute}function xi(t){return t.set||t.get||t.hasOwnProperty("value")}function Pi(t,e){return Si(e[1])&&(t.attributes[e[0]]=e[1].attribute),xi(e[1])&&(t.properties[e[0]]=e[1]),t}function Xt(t,e,i,o,r=""){let{name:s,tag:u}=Ti(t),l=typeof u=="string"?vi(u):HTMLElement,{attributes:p,properties:h}=i?Object.entries(i).reduce(Pi,{attributes:{},properties:{}}):yi;function f(){let m=Reflect.construct(l,arguments,f),y=e.construct&&e.construct.length>ze?Ue(m,e,o||e.stylesheet):void 0,a=f.formAssociated?Ei(m):{};return u&&(_e=!0),e.construct&&e.construct.call(m,y,a),h&&Object.keys(h).reduce(bi,m),m}return f.prototype=Object.create(l.prototype,h),h.value&&(f.formAssociated=!0,Ge(f.prototype,wi),(e.enable||e.disable)&&(f.prototype.formDisabledCallback=function(m){return m?e.disable&&e.disable.call(this,this[Y],this[A]):e.enable&&e.enable.call(this,this[Y],this[A])}),e.reset&&(f.prototype.formResetCallback=function(){return e.reset.call(this,this[Y],this[A])}),e.restore&&(f.prototype.formStateRestoreCallback=function(){return e.restore.call(this,this[Y],this[A])})),p&&(f.observedAttributes=Object.keys(p),f.prototype.attributeChangedCallback=function(m,y,a){return p[m].call(this,a)}),f.prototype.connectedCallback=function(){let m=this,y=m[Y],a=m[A];if(m._initialLoad){let d=y.querySelectorAll('link[rel="stylesheet"]');if(d.length){let w=0,F=d.length,D=function(_t){++w>=d.length&&(delete m._initialLoad,e.load&&e.load.call(m,y))},nt=D;for(;F--;)d[F].addEventListener("load",D,Re),d[F].addEventListener("error",nt,Re)}else e.load&&Promise.resolve(1).then(()=>e.load.call(this,y,a))}e.connect&&e.connect.call(this,y,a)},e.disconnect&&(f.prototype.disconnectedCallback=function(){return e.disconnect.call(this,this[Y],this[A])}),window.console&&window.console.log("%c<"+(u?u+" is="+s:s)+">%c "+r,"color: #3a8ab0; font-weight: 600;","color: #888888; font-weight: 400;"),window.customElements.define(s,f,u&&{extends:u}),u&&!_e&&document.querySelectorAll('[is="'+s+'"]').forEach(m=>{i&&Ge(m,i);let y=e.construct&&e.construct.length>ze?Ue(m,e,o||e.stylesheet):void 0;e.construct&&e.construct.call(m,y);let a;for(a in p){let d=m.attributes[a];d&&p[a].call(m,d.value)}e.connect&&e.connect.apply(m)}),f}var $t=Symbol("privates");function L(t){return t[$t]||Object.defineProperty(t,$t,{value:{}})[$t]}function it(t,e,i){return i>e?e:i<t?t:i}var Ar=E(it);function Kt(t){return function(){return arguments[t]}}function B(){return this}var ki=Object.assign,Oi=Object.create,Ai=Object.freeze;function Li(){return!0}function We(){return-1}var j=Ai(ki(Oi({shift:P,push:P,forEach:P,join:function(){return""},every:Li,filter:B,find:P,findIndex:We,flat:B,flatMap:B,includes:function(){return!1},indexOf:We,map:B,reduce:Kt(1),sort:B,each:B,pipe:b,start:B,stop:B,done:B,valueOf:function(){return null}}),{length:0}));function ot(t,e){t.remove&&t.remove(e);let i;for(;(i=t.indexOf(e))!==-1;)t.splice(i,1);return t}var Ir=E(ot,!0);function Jt(t){return t&&t[Symbol.iterator]}var Bi=Object.assign;function Ci(t){return t.stop?t.stop():t()}function rt(){}Bi(rt.prototype,{stop:function(){let t=this.stopables;return this.stopables=void 0,t&&t.forEach(Ci),this},done:function(t){return(this.stopables||(this.stopables=[])).push(t),this}});var I=Object.assign,_=Object.create;function st(t,e){t[0]=e,e.done(t)}function Ne(t,e){let i=t[e].stopables;i&&ot(i,t),t[e]=void 0}function T(t,e){t&&t.push(e)}function S(t){rt.prototype.stop.apply(t);let e=-1,i;for(;i=t[++e];)t[e]=void 0,i.stop()}function qe(t){return c.prototype.isPrototypeOf(t)}function c(t){this.input=t}I(c.prototype,rt.prototype,{push:function(t){T(this[0],t)},pipe:function(t){if(this[0])throw new Error("Stream: Attempt to .pipe() a unicast stream multiple times. Create a multicast stream with stream.broadcast().");return this[0]=t,t.done(this),this.input.pipe(this),t},map:function(t){return new Ye(this,t)},filter:function(t){return new Xe(this,t)},split:function(t){return new Ke(this,t)},flatMap:function(t){return new $e(this,t)},take:function(t){return new Je(this,t)},each:function(t){return this.pipe(new tn(t))},reduce:function(t,e){return this.pipe(new Qe(t,e)).value},scan:function(t,e){return new Ze(this,t,e)},stop:function(){return S(this),this}});function Ye(t,e){this.input=t,this.fn=e}Ye.prototype=I(_(c.prototype),{push:function(e){let o=this.fn(e);o!==void 0&&T(this[0],o)}});function Xe(t,e){this.input=t,this.fn=e}Xe.prototype=I(_(c.prototype),{push:function(e){this.fn(e)&&T(this[0],e)}});function $e(t,e){this.input=t,this.fn=e}$e.prototype=I(_(c.prototype),{push:function(e){let o=this.fn(e);if(o!==void 0)if(Jt(o))for(let r of o)T(this[0],r);else o.pipe&&this.done(o.each(r=>T(this[0],r)))}});function Ke(t,e){this.input=t,this.chunk=[],typeof n=="number"?this.n=e:this.fn=e}Ke.prototype=I(_(c.prototype),{fn:function(){return this.chunk.length===this.n},push:function(e){let i=this.chunk;this.fn(e)?(T(this[0],i),this.chunk=[]):i.push(e)}});function Je(t,e){this.input=t,this.count=e}Je.prototype=I(_(c.prototype),{push:function(e){this[0].push(e),--this.count||this.stop()}});function Qe(t,e){this.fn=t,this.value=e,this.i=0}Qe.prototype=I(_(c.prototype),{push:function(t){let e=this.fn;this.value=e(this.value,t,this.i++,this)}});function Ze(t,e,i){this.input=t,this.fn=e,this.value=i}Ze.prototype=I(_(c.prototype),{push:function(t){let e=this.fn;this.value=e(this.value,t),this[0].push(this.value)}});function tn(t){this.push=t}tn.prototype=I(_(c.prototype),{each:null,reduce:null,pipe:null});var Mi=Object.assign,Fi=Object.create;function Di(t,e){if(t[1]){let i=-1;for(;t[++i]&&t[i]!==e;);for(;t[i++];)t[i-1]=t[i]}else t.stop()}function ut(t,e){c.apply(this,arguments),this.memory=!!(e&&e.memory),e&&e.hot&&this.pipe(j)}ut.prototype=Mi(Fi(c.prototype),{push:function(t){if(t===void 0)return;this.memory&&(this.value=t);let e=-1;for(;this[++e];)this[e].push(t)},pipe:function(t){let e=-1;for(;this[++e];);return this.memory&&e===0&&this.input.pipe(this),this[e]=t,t.done(()=>Di(this,t)),this.value!==void 0&&t.push(this.value),!this.memory&&e===0&&this.input.pipe(this),t}});var Vi=Array.prototype,Hi=Object.assign,ji=Object.create;function Ii(t){return t!==void 0}function at(t){this.buffer=t?t.filter?t.filter(Ii):t:[]}at.prototype=Hi(ji(c.prototype),{push:function(t){t!==void 0&&T(this.buffer,t)},pipe:function(t){for(t.done(this),this[0]=t;this.buffer.length;)T(this[0],Vi.shift.apply(this.buffer));return this.buffer=t,t},stop:function(){return this.buffer=void 0,S(this),this}});var en=Object.assign,Gi=Object.create,Ri=Promise.resolve(),zi={schedule:function(){Ri.then(this.fire)},unschedule:P},_i={schedule:function(){this.timer=requestAnimationFrame(this.fire)},unschedule:function(){cancelAnimationFrame(this.timer),this.timer=void 0}},Ui={schedule:function(){this.timer=setTimeout(this.fire,this.duration*1e3)},unschedule:function(){clearTimeout(this.timer),this.timer=void 0}};function X(t,e){c.apply(this,arguments),this.duration=e,this.timer=void 0,this.fire=()=>{this.timer=void 0,this.output.stop()},en(this,e==="tick"?zi:e==="frame"?_i:Ui)}X.prototype=en(Gi(c.prototype),{push:function(t){this.timer?(this.unschedule(),this.schedule(),this.output.push(t)):(this.output=c.of(t),this[0].push(this.output),this.schedule())},stop:function(){return this.timer&&this.fire(),c.prototype.stop.apply(this,arguments)}});var Qt=Object.assign,Wi=Object.create,nn=Object.keys;function Zt(t,e,i,o,r){this.stream=t,this.names=e,this.values=i,this.name=o,this.input=r}Qt(Zt.prototype,{push:function(t){let e=this.stream,i=this.values,o=this.name;i[o]=t,(e.active||(e.active=nn(i).length===this.names.length))&&T(e[0],Qt({},i))},stop:function(){--this.stream.count===0&&S(this.stream)},done:function(t){this.stream.done(t)}});function yt(t){this.inputs=t,this.active=!1}yt.prototype=Qt(Wi(c.prototype),{push:null,pipe:function(t){let e=this.inputs,i=nn(e),o={};this.count=i.length,this[0]=t,t.done(this);let r;for(r in e){let s=e[r];if(s.pipe){let u=new Zt(this,i,o,r,s);s.pipe(u)}else if(s.then){let u=new Zt(this,i,o,r,s);s.then(l=>u.push(l)),s.finally(()=>u.stop())}else o[r]=s,--this.count}return t}});var on=Object.assign,Ni=Object.create;function rn(t){this.stream=t}on(rn.prototype,{push:function(t){T(this.stream[0],t)},stop:function(){--this.stream.count===0&&S(this.stream)},done:function(t){this.stream.done(t)}});function vt(t){this.inputs=t}vt.prototype=on(Ni(c.prototype),{push:null,pipe:function(t){let e=this.inputs;this.count=e.length,this[0]=t,t.done(this);let i=new rn(this),o=-1,r;for(;r=e[++o];)if(r.pipe)r.pipe(i);else if(r.then)r.then(s=>i.push(s)),r.finally(()=>i.stop());else{let s=-1;for(;++s<r.length;)i.push(r[s]);i.stop()}return t}});var qi=Object.assign,Yi=Object.create;function Tt(t){this.promise=t}Tt.prototype=qi(Yi(c.prototype),{push:null,pipe:function(t){let e=this.promise;return this[0]=t,t.done(this),e.then(i=>T(this,i)),e.finally(()=>S(this)),t}});var Xi=Array.prototype,sn=Object.assign;function $i(t){throw new TypeError("Stream cannot be created from "+typeof object)}sn(c,{isStream:qe,of:function(){return new at(Xi.slice.apply(arguments))},from:function(t){return t.pipe?new c(t):t.then?new Tt(t):typeof t.length=="number"?new at(t):$i(t)},batch:t=>new X(j,t),burst:t=>(console.warn("Stream.burst() is now Stream.batch()"),new X(j,t)),broadcast:t=>new ut(j,t),combine:t=>new yt(t),merge:function(){return new vt(arguments)},writeable:function(t){let e=new c(j);return t(e),e}});sn(c.prototype,{log:B,batch:function(t){return new X(this,t)},burst:function(t){return console.warn("stream.burst() is now stream.batch()"),new X(this,t)},broadcast:function(t){return new ut(this,t)}});function te(t){if(typeof t!="object"||arguments.length>1)throw new Error("delegate() now takes an object of selector:fn pairs.");let e=Object.keys(t);return function(o){let r=o.target,s=-1;for(;e[++s];){let u=r.closest(e[s]);if(u)return t[e[s]](u,...arguments)}}}var Ki=Object.assign,Ji=/\s+/,bt={fullscreenchange:Q(()=>"fullscreenElement"in document?"fullscreenchange":"webkitFullscreenElement"in document?"webkitfullscreenchange":"mozFullScreenElement"in document?"mozfullscreenchange":"msFullscreenElement"in document?"MSFullscreenChange":"fullscreenchange")},un=0;window.addEventListener("click",t=>un=t.timeStamp);function Qi(t,e){return t.node.addEventListener(bt[e]?bt[e]():e,t,t.options),t}function Zi(t,e){return t.node.removeEventListener(bt[e]?bt[e]():e,t),t}function an(t,e,i){this.types=t.split(Ji),this.options=e,this.node=i,this.select=e&&e.select}Ki(an.prototype,{pipe:function(t){st(this,t),this.types.reduce(Qi,this)},handleEvent:function(t){if(!(t.type==="click"&&t.timeStamp<=un)){if(this.select){let e=t.target.closest(this.select);if(!e)return;t.selectedTarget=e}T(this[0],t)}},stop:function(){this.types.reduce(Zi,this),S(this[0])}});function ee(t,e){let i;return typeof t=="object"&&(i=t,t=i.type),new c(new an(t,i,e))}var to=Object.assign,lt={bubbles:!0,cancelable:!0};function Et(t,e){var h;let i=lt,o,r,s,u,l,p;return typeof t=="object"?(h=t,{type:t,detail:r,bubbles:s,cancelable:u,composed:l}=h,o=De(h,["type","detail","bubbles","cancelable","composed"]),p=to(new CustomEvent(t,{detail:r,bubbles:s||lt.bubbles,cancelable:u||lt.cancelable,composed:l||lt.composed}),o)):p=new CustomEvent(t,lt),e.dispatchEvent(p)}var Ss=E(Et,!0);function ne(t){return Math.pow(10,t/20)}function M(t){if(!t)return 0;let e=+t;if(e||e===0)return e;let i=/^(?:(-?[\d.]+)|(-?∞))(?:(db|bpm)|(m|k)?(\w+))$/.exec(t.toLowerCase());if(!i)return 0;let o=i[2]?i[2]==="-∞"?-1/0:1/0:parseFloat(i[1]);return i[3]==="db"?ne(o):i[3]==="bpm"?o/60:i[4]==="m"?o/1e3:i[4]==="k"?o*1e3:o}function pt(t){return typeof t}function eo(t,e){let i=t[t.length-1];return i&&!/^-?\d/.test(e)?i.label=e:t.push({label:e,value:M(e)}),t}var $=v(pt,{string:function(e){let i=e.trim();return i?i.split(/\s*,\s*|\s+/).reduce(eo,[]):[]},object:b});function k(t,e){return Math.ceil(e/t)*t}var ln=v(t=>t.toLowerCase(),{db:(t,e,i)=>$("-∞dB -96dB -90dB -84dB -78dB -72dB -66dB -60dB -54dB -48dB -42dB -36dB -30dB -24dB -18dB -12dB -6dB 0dB 6dB 12dB 18dB 24dB"),default:(t,e,i)=>{let o=i-e,r=o<.8?k(.05,o/10):o<2?k(.2,o/10):o<8?k(.5,o/10):o<20?k(2,o/10):o<80?k(5,o/10):o<200?k(20,o/10):k(200,o),s=[],u=o<.8?k(.05,e):o<2?k(.2,e):o<8?k(.5,e):o<20?k(2,e):o<80?k(5,e):o<200?k(20,e):k(200,e);for(;u<=i;)s.push({label:o<2?u.toFixed(1):u,value:u}),u+=r;return s}});function pn(t,e,i,o){return t.normalValue=e.normalise(i,o,t.value),t}function ie(t,e){let{scale:i,min:o,max:r,ticks:s,step:u,display:l}=e;return t.scale=i,t.min=o,t.max=r,t.ticks=(s?s.length?s:ln(l,o,r):j).filter(p=>p.value>=t.min&&p.value<=t.max).map(p=>pn(p,i,o,r)),t.step=u==="any"?void 0:u==="tick"?t.ticks:$(u).filter(p=>p.value>=t.min&&p.value<=t.max).map(p=>pn(p,i,o,r)),t.display=l,t}var cn=.00390625;var hn=.0009765625,fn=.00048828125,mn=.000244140625;var dn=1525878906e-14,oe=.25,gn=.4,Ns=Symbol("state");var wn=Object.assign;function ro(t,e,i){return(i-t)/(e-t)}function H(t,e,i){return t+i*(e-t)}var xt={};function re(t,e,i){let o=i/(e*t);return(o<=1?o:Math.log(o)+1)/xt[t]}function so(t,e,i){let o=i*xt[t];return e*t*(o<=1?o:Math.pow(Math.E,o-1))}function G(t){this.xover=t,xt[t]||(xt[t]=Math.log(1/t)+1)}wn(G.prototype,{normalise:function(t,e,i){let o=re(this.xover,e,t);return(re(this.xover,e,i)-o)/(1-o)},denormalise:function(t,e,i){let o=re(this.xover,e,t),r=i*(1-o)+o;return so(this.xover,e,r)}});function St(t){this.power=t}wn(St.prototype,{normalise:function(t,e,i){return Math.pow((i-t)/(e-t),1/this.power)},denormalise:function(t,e,i){return Math.pow(i,this.power)*(e-t)+t}});var uo={linear:{normalise:ro,denormalise:H},"pow-2":new St(2),"pow-3":new St(3),"pow-4":new St(4),log:{normalise:function(t,e,i){return Math.log(i/t)/Math.log(e/t)},denormalise:function(t,e,i){return t*Math.pow(e/t,i)}},"log-24db":new G(.0625),"log-30db":new G(.03125),"log-36db":new G(.015625),"log-48db":new G(cn),"log-60db":new G(hn),"log-66db":new G(fn),"log-72db":new G(mn),"log-96db":new G(dn)};function se(t){return uo[t&&t.toLowerCase()||"linear"]}function ue(t){return 20*Math.log10(t)}function yn(t,e){return{unit:e<1?"m"+t:e>=1e3?"k"+t:t,value:e<.001?(e*1e3).toFixed(2):e<1?(e*1e3).toPrecision(3):e>=1e3?(e/1e3).toPrecision(3):e.toPrecision(3)}}var Qs=v(t=>t.toLowerCase(),{pan:(t,e)=>({unit:"",value:e===-1?"-1.00":e===0?"0.00":e===1?"1.00":e.toFixed(2)}),db:(t,e)=>{let i=ue(e);return{unit:"dB",value:isFinite(i)?i<-1?i.toPrecision(3):i.toFixed(2):i<0?"-∞":"∞"}},hz:(t,e)=>({unit:e>=1e3?"kHz":"Hz",value:e<1?e.toFixed(2):e>=1e3?(e/1e3).toPrecision(3):e.toPrecision(3)}),semitone:(t,e)=>({unit:"",value:e===0?"0":e<0?"♭"+(-e/100).toFixed(2):"♯"+(e/100).toFixed(2)}),s:yn,bpm:(t,e)=>{let i=e*60;return{unit:"bpm",value:i<100?i.toFixed(1):i.toFixed(0)}},int:(t,e)=>({unit:"",value:Math.round(e)}),"":(t,e)=>({unit:"",value:e>-1&&e<1?e.toFixed(2):e.toPrecision(3)}),default:yn});function ao(t,e){return e[t]}var R=E(ao,!0);function K(t){if(typeof t.length=="number")return t[t.length-1]}var lo=Object.assign,po=Object.defineProperties,co=Object.isExtensible,ho=Object.prototype,U=Symbol("observe");function fo(t,e){let i=t.indexOf(e);return i>-1&&t.splice(i,1),t}var vn={[U]:{}};function Pt(t,e){if(!t||!t.length)return 0;t=t.slice(0);for(var i=-1;t[++i];)t[i].status!=="stopped"&&t[i].push(e);return i}function Tn(t){this.observables={},this.gets=[],this.sets=void 0,this.target=t,this.observer=new Proxy(t,this),vn[U].value=this,po(t,vn)}lo(Tn.prototype,{notify:function(t){Pt(this.observables[t],this.target[t]),Pt(this.sets,this.target)},listen:function(t,e){(t===null?this.sets||(this.sets=[]):this.observables[t]||(this.observables[t]=[])).push(e)},unlisten:function(t,e){let i=t===null?this.sets:this.observables[t];i&&fo(i,e)},get:function(e,i,o){let r=e[i];if(typeof i=="symbol"||i==="__proto__")return r;let s=Object.getOwnPropertyDescriptor(e,i);if((s?s.writable||s.set:r===void 0)&&Pt(this.gets,i),!ho.hasOwnProperty.call(e,i))return r;let l=Z(r);if(!l)return r;for(var p=-1;this.gets[++p];)this.gets[p].listen(i);return l},set:function(e,i,o,r){if(typeof i=="symbol"||i==="__proto__")return e[i]=o,!0;let s=J(o);if(e[i]===o||e[i]===s)return!0;let u=e.length;for(var l=-1;this.gets[++l];)this.gets[l].unlisten(i);return e[i]=s,i!=="length"&&e.length!==u&&Pt(this.observables.length,e.length),this.notify(i),!0},deleteProperty:function(t,e){return typeof e=="symbol"||e==="__proto__"?(delete t[e],!0):(t.hasOwnProperty(e)&&(delete t[e],this.notify(e)),!0)}});function kt(t){return t&&co(t)&&!Node.prototype.isPrototypeOf(t)&&(typeof BaseAudioContext>"u"||!BaseAudioContext.prototype.isPrototypeOf(t))&&!(t instanceof Date)&&!(t instanceof RegExp)&&!(t instanceof Map)&&!(t instanceof WeakMap)&&!(t instanceof Set)&&!(window.WeakSet&&t instanceof WeakSet)&&!ArrayBuffer.isView(t)}function Z(t,e){return t?t[U]?t[U].observer:e||kt(t)?new Tn(t).observer:void 0:void 0}function J(t){return t&&t[U]&&t[U].target||t}function ae(t){return Z(t)&&t[U]}function bn(t,e){let i=e[U];i&&i.notify(t)}var En=Object.assign,mo=Object.create,le=/(^\.?|\.)\s*([\w-]*)\s*/g;function go(t){this.producer.push(t)}function pe(t,e,i,o){le.lastIndex=e;let r=le.exec(t);this.path=t,this.object=i,this.producer=o,this.key=r[2]||r[1],this.index=le.lastIndex,this.isMuteableObserver=this.path.slice(this.index)===".",this.index>=this.path.length&&(this.push=go),this.listen(),this.push(this.key==="."?this.object:J(this.object)[this.key])}En(pe.prototype,{push:function(t){kt(t)?this.child?this.child.relisten(t):this.child=new pe(this.path,this.index,t,this.producer):(this.child&&(this.child.stop(),this.child=void 0),this.producer.push(this.isMuteableObserver?t:void 0))},listen:function(){let t=ae(this.object);t&&t.listen(this.key==="."?null:this.key,this)},unlisten:function(){ae(this.object).unlisten(this.key==="."?null:this.key,this)},relisten:function(t){this.unlisten(),this.object=t,this.listen(),this.push(J(this.object)[this.key])},stop:function(){this.unlisten(),this.child&&this.child.stop(),this.child=void 0,this.status="stopped"}});function Sn(t,e,i){this.path=t,this.object=e,this.value=i}Sn.prototype=En(mo(c.prototype),{push:function(t){this.value===t&&(!this.isMutationProducer||!kt(t))||(this.value=t,this[0].push(t))},pipe:function(t){return this[0]=t,t.done(this),this.pathObserver=new pe(this.path,0,this.object,this),this.isMutationProducer=this.path[this.path.length-1]===".",t},stop:function(){return this.pathObserver.stop(),c.prototype.stop.apply(this,arguments)}});function Ot(t,e,i){return new c(new Sn(t,e,i))}var wo=/^\s*([+-]?\d*\.?\d+)([^\s\d]*)\s*$/;function ce(t){return function(i){if(typeof i=="number")return i;var o=wo.exec(i);if(!o||!t[o[2]||""]){if(!t.catch)throw new Error('Cannot parse value "'+i+'" (accepted units '+Object.keys(t).join(", ")+")");return o?t.catch(parseFloat(o[1]),o[2]):t.catch(parseFloat(i))}return t[o[2]||""](parseFloat(o[1]))}}var yo=/px$/,xn={"transform:translateX":function(t){var e=ct("transform",t);if(!e||e==="none")return 0;var i=At(e);return parseFloat(i[4])},"transform:translateY":function(t){var e=ct("transform",t);if(!e||e==="none")return 0;var i=At(e);return parseFloat(i[5])},"transform:scale":function(t){var e=ct("transform",t);if(!e||e==="none")return 0;var i=At(e),o=parseFloat(i[0]),r=parseFloat(i[1]);return Math.sqrt(o*o+r*r)},"transform:rotate":function(t){var e=ct("transform",t);if(!e||e==="none")return 0;var i=At(e),o=parseFloat(i[0]),r=parseFloat(i[1]);return Math.atan2(r,o)}};function At(t){return t.split("(")[1].split(")")[0].split(/\s*,\s*/)}function ct(t,e){return window.getComputedStyle?window.getComputedStyle(e,null).getPropertyValue(t):0}function Lt(t,e){if(xn[t])return xn[t](e);var i=ct(t,e);return typeof i=="string"&&yo.test(i)?parseFloat(i):i}var Bt,Ct;function vo(){if(!Bt){let t=document.documentElement.style.fontSize;document.documentElement.style.fontSize="100%",Bt=Lt("font-size",document.documentElement),document.documentElement.style.fontSize=t||""}return Bt}function To(){return Ct||(Ct=Lt("font-size",document.documentElement)),Ct}window.addEventListener("resize",()=>{Bt=void 0,Ct=void 0});var V=v(pt,{number:b,string:ce({px:b,em:t=>vo()*t,rem:t=>To()*t,vw:t=>window.innerWidth*t/100,vh:t=>window.innerHeight*t/100,vmin:t=>window.innerWidth<window.innerHeight?window.innerWidth*t/100:window.innerHeight*t/100,vmax:t=>window.innerWidth<window.innerHeight?window.innerHeight*t/100:window.innerWidth*t/100})}),Pn=V;var bo=Array.prototype,fe=Object.assign,he="webkitUserSelect"in document.body.style?"webkitUserSelect":"userSelect",Mt={},Ft={threshold:4,ignoreTags:{textarea:!0,input:!0,select:!0}};function Eo(t,e,i){return e*e+i*i>=t*t}function kn(t,e,i){if(this.stream=t,this.events=[e],this.options=i,this.pointerId=e.pointerId,typeof i.threshold=="function")this.checkThreshold=i.threshold;else{let o=Pn(i.threshold);this.checkThreshold=(r,s,u)=>Eo(o,r,s,u)}document.addEventListener("pointermove",this),document.addEventListener("pointerup",this),document.addEventListener("pointercancel",this)}fe(kn.prototype,{handleEvent:v(R("type"),{pointermove:function(t){if(this.pointerId===t.pointerId){if(this.pointerId in Mt&&this!==Mt[this.pointerId]){this.stop();return}if(this.events.push(t),!this.isGesture){let e=this.events[0],i=t.clientX-e.clientX,o=t.clientY-e.clientY,r=(t.timeStamp-e.timeStamp)/1e3;this.checkThreshold(i,o,r)&&this.createGesture()}}},default:function(t){if(this.pointerId!==t.pointerId){console.log("Not the same pointer");return}this.events.push(t),this.stop()}}),createGesture:function(){this.isGesture=!0,this.userSelectState=document.body.style[he],document.body.style[he]="none",Mt[this.pointerId]=this,this.stream.push(new c(this))},pipe:function(t){for(st(this,t);this.events.length;)T(this[0],bo.shift.apply(this.events));this.events=t},stop:function(){if(document.removeEventListener("pointermove",this),document.removeEventListener("pointerup",this),document.removeEventListener("pointercancel",this),this.isGesture&&(document.body.style[he]=this.userSelectState,delete Mt[this.pointerId]),this[0]){let t=this[0];Ne(this,0),S(t)}}});function So(t){var e=t.target.tagName;return e&&(!!Ft.ignoreTags[e.toLowerCase()]||t.target.draggable)}function On(t,e){this.node=t,this.options=e}fe(On.prototype,{pipe:function(t){return this[0]=t,this.node.addEventListener("pointerdown",this),t},handleEvent:function(t){if(t.button===0&&!(this.options.device&&!this.options.device.includes(t.pointerType))&&!So(t)&&!(this.options.select&&!t.target.closest(this.options.select))){var e={type:t.type,target:t.target,currentTarget:t.currentTarget,clientX:t.clientX,clientY:t.clientY,timeStamp:t.timeStamp,pointerId:t.pointerId};new kn(this[0],e,this.options)}},stop:function(){return this[0]&&(this.node.removeEventListener("pointerdown",this),S(this[0])),this}});function me(t,e){return t=e&&t?fe({},Ft,t):Ft,e=e||t,new c(new On(e,t))}function xo(){return{x:0,y:0,left:0,top:0,right:window.innerWidth,bottom:window.innerHeight,width:window.innerWidth,height:window.innerHeight}}function Dt(t){return t===window?xo():t.getClientRects()[0]||t.getBoundingClientRect()}function An(t,e,i,o){return e.delete(i),o.forEach(r=>e.append(i,r.x+","+r.y)),t.setFormValue(e),e}var de=[];function Ln(t,e){t.clearRect(e.x,e.y,e.width,e.height)}function Bn(t,e,i,o){t.beginPath();let r=-1;for(;++r<i.length;)t.moveTo(e.x+i[r]*e.width,e.y),t.lineTo(e.x+i[r]*e.width,e.y+e.height);t.lineWidth="1",t.lineCap="round",t.strokeStyle=o,t.setLineDash(de),t.stroke(),t.closePath()}function Cn(t,e,i,o){t.beginPath();let r=-1;for(;++r<i.length;)t.moveTo(e.x,e.y+(1-i[r])*e.height),t.lineTo(e.x+e.width,e.y+(1-i[r])*e.height);t.lineWidth="1",t.lineCap="round",t.strokeStyle=o,t.setLineDash(de),t.stroke(),t.closePath()}function Mn(t,e,i,o,r){t.beginPath(),t.moveTo(0,e.y+(1-o.y)*e.height),t.lineTo(e.x+o.x*e.width-i,e.y+(1-o.y)*e.height),t.moveTo(e.x+o.x*e.width+i,e.y+(1-o.y)*e.height),t.lineTo(e.x+e.width+100,e.y+(1-o.y)*e.height),t.moveTo(e.x+o.x*e.width,0),t.lineTo(e.x+o.x*e.width,e.y+(1-o.y)*e.height-i),t.moveTo(e.x+o.x*e.width,e.y+(1-o.y)*e.height+i),t.lineTo(e.x+o.x*e.width,e.y+e.height+100),t.lineWidth="1",t.lineCap="round",t.strokeStyle=r,t.setLineDash(de),t.stroke(),t.closePath()}function Po(t,e,i){let o=t(e),r=t(i);return r===o?0:o>r?1:-1}var ge=E(Po,!0);var tt=function(){};function Fn(t,e){return e.length<t?e:e.slice(0,t-3)+"..."}var we=window.console?console.log.bind(console,"%cSoundstage %c%s","color: #e02053; font-weight: 600;","color: #8e9e9d; font-weight: 300;"):tt,Fu=window.console?console.groupCollapsed.bind(console,"%cSoundstage %c%s","color: #e02053; font-weight: 600;","color: #8e9e9d; font-weight: 300;"):tt,Du=window.console?console.groupEnd.bind(console):tt,ye=window.console?function(t,e,i="",...o){typeof i=="string"&&(i=Fn(48,i)),console.log("%c"+t+" %c"+(e||""),"color: #b5002f; font-weight: 600;","color: #8e9e9d; font-weight: 300;",i,...o)}:tt,ht=window.console?function(t,e,i="",...o){typeof i=="string"&&(i=Fn(48,i)),console.groupCollapsed("%c"+t+" %c"+(e||""),"color: #b5002f; font-weight: 600;","color: #8e9e9d; font-weight: 300;",i,...o)}:tt,ft=window.console?console.groupEnd.bind(console):tt;var Vt=!1,ko=Object.assign,Dn=Object.defineProperties,Oo={startTime:{writable:!0},stopTime:{writable:!0}};function z(){Vt&&ht("mixin ","PlayNode"),Dn(this,Oo),Vt&&ft()}z.reset=function(t){return t.startTime=void 0,t.stopTime=void 0,t};ko(z.prototype,{start:function(t){if(Vt&&this.startTime!==void 0)throw new Error("Attempt to start a node that is already started");return this.startTime=t||this.context.currentTime,this},stop:function(t){if(Vt&&this.startTime===void 0)throw new Error("Attempt to stop a node that has not been started");return t=t||this.context.currentTime,this.stopTime=this.startTime===void 0||t>this.startTime?t:this.startTime,this}});Dn(z.prototype,{playing:{get:function(){return this.startTime!==void 0&&this.startTime<=this.context.currentTime&&(this.stopTime===void 0||this.startTime>this.stopTime||this.context.currentTime<this.stopTime)}}});function ve(t){return function(i,...o){var r=t[i]||t.default;return r&&r.apply(this,o)}}window.AudioContext=window.AudioContext||window.webkitAudioContext;AudioContext.prototype.getOutputTimestamp||(AudioContext.prototype.getOutputTimestamp=function(){return{contextTime:this.currentTime+this.outputLatency,performanceTime:window.performance.now()}});var W=new window.AudioContext;W.destination.channelInterpretation="discrete";W.destination.channelCount=W.destination.maxChannelCount;W.baseLatency===void 0&&(W.baseLatency=256/W.sampleRate);if(W.state==="suspended"){we("Audio context suspended","User interaction required");let t=["mousedown","keydown","touchstart","contextmenu"],e=(o,r)=>(document.addEventListener(r,o),o),i=(o,r)=>(document.removeEventListener(r,o),o);t.reduce(e,function o(r){W.resume().then(function(){we('Audio context resumed on "'+r.type+'"'),t.reduce(i,o)})})}function Ao(t,e){return t.contextTime+(e-t.performanceTime)/1e3}function Te(t,e){var i=t.getOutputTimestamp();return Ao(i,e)}var x={channelCountLimit:12,basePath:window.soundstageBasePath||"/soundstage/",automationEventsKey:"automationEvents",animationFrameKey:"animationFrame",minExponentialValue:14013e-49,targetDurationFactor:9};var jt=!1,Hn=1e3/60;function Lo(t){return window.AudioParam&&window.AudioParam.prototype.isPrototypeOf(t)}function mt(t){if(jt&&!Lo(t))throw new Error("Not an AudioParam "+JSON.stringify(t));return t[x.automationEventsKey]||(t[x.automationEventsKey]=[])}var jn=v(R(1),{target:function(t){if(t[3]===void 0)throw new Error('Event "target" must have 2 parameters: [time, "target", value, duration]')},hold:function(t){if(t[2]!==void 0)throw new Error('Event "hold" takes 0 parameters: [time, "hold"]')},default:function(t){if(t[2]===void 0)throw new Error('Event "'+t[1]+'" must have 1 parameter: [time, "'+t[1]+'", value]')}});function Vn(t,e){t.cancelScheduledValues(e.time),e.curve==="linear"?t.linearRampToValueAtTime(e.value,e.time):e.curve==="exponential"?t.exponentialRampToValueAtTime(e.value,e.time):e.curve==="step"&&t.setValueAtTime(e.value,e.time)}var Bo={step:(t,e)=>t.setValueAtTime(e.value,e.time),linear:(t,e)=>t.linearRampToValueAtTime(e.value,e.time),exponential:(t,e)=>t.exponentialRampToValueAtTime(e.value,e.time),target:(t,e)=>t.setTargetAtTime(e.value,e.time,e.duration),curve:(t,e)=>t.setValueCurveAtTime(e.value,e.time,e.duration),hold:AudioParam.prototype.cancelAndHoldAtTime?function(e,i,o){if(o&&o.curve==="target")return Vn(e,i);e.cancelAndHoldAtTime(i.time)}:Vn},Co=v(b,{exponential:(t,e,i,o,r,s)=>{let u={time:r,value:Math.fround(s)};return u.value<=x.minExponentialValue?(u.time=i?i.time:0,u.curve="step"):i&&i.value<x.minExponentialValue?u.curve="step":u.curve="exponential",u},hold:function(t,e,i,o,r){return o&&o.curve==="linear"?{time:r,curve:"linear",value:Math.fround(be(i,o,r))}:o&&o.curve==="exponential"?{time:r,curve:"exponential",value:Math.fround(be(i,o,r))}:i&&i.curve==="target"?{time:r,curve:"step",value:dt(e,r)}:{time:r}},target:(t,e,i,o,r,s,u)=>({time:r,curve:"target",value:Math.fround(s),duration:u}),default:(t,e,i,o,r,s,u)=>({time:r,curve:t,value:Math.fround(s)})}),Mo=ve({hold:function(t,e,i,o){i.length=o+1,e.curve&&i.push(e)},default:function(t,e,i,o){if(!t){i.push(e);return}if(t.time===e.time){for(;i[++o]&&i[o].time===e.time;)if(i[o].curve===e.curve){i.splice(o,1,e);return}i.splice(o,0,e);return}i.splice(o+1,0,e)}});function In(t,e,i,o,r,s){for(var u=e.length;e[--u]&&e[u].time>=i;);let l=e[u],p=e[u+1],h=Co(o,t,l,p,i,r,s);Bo[o](t,h,p),Mo(o,p,h,e,u)}function Ee(t,e,i,o,r,s,u){if(i==="target"&&r===void 0)throw new Error('Automation curve "target" must have a duration');let l=mt(t);if(In(t,l,e,i,o,r),!s){jt&&console.warn("No notify for param change",o,i,t);return}if(!u){jt&&console.warn("No context for param change",o,i,t);return}if(t[x.animationFrameId])return;var p=-1;function h(f){if(p=(p+1)%3,p===0){t[x.animationFrameId]=requestAnimationFrame(h);return}let m=f+Hn,y=Te(u,m),a=dt(t,y),d=l[l.length-1];t[x.animationFrameId]=d&&y<=d.time?requestAnimationFrame(h):void 0,s(t,"value",a)}t[x.animationFrameId]=requestAnimationFrame(h)}function Gn(t,e,i,o,r,s,u){if(o==="target"&&s===void 0)throw new Error('Automation curve "target" must have a duration');let l=t[e],p=mt(l);if(In(l,p,i,o,r,s),!u){jt&&console.warn("No notify for param change",r,o,l);return}if(l[x.animationFrameId])return;var h=-1;function f(m){if(h=(h+1)%3,h===0){l[x.animationFrameId]=requestAnimationFrame(f);return}let y=m+Hn,a=Te(t.context,y),d=dt(l,a),w=p[p.length-1];l[x.animationFrameId]=w&&a<=w.time?requestAnimationFrame(f):void 0,u(t,e,d)}l[x.animationFrameId]=requestAnimationFrame(f)}var Rn={step:function(e,i,o,r,s){return s<r?e:i},linear:function(e,i,o,r,s){return e+(i-e)*(s-o)/(r-o)},exponential:function(e,i,o,r,s){return e*Math.pow(i/e,(s-o)/(r-o))},target:function(e,i,o,r,s,u){return s<r?e:i+(e-i)*Math.pow(Math.E,(r-s)/u)},curve:function(t,e,i,o,r,s){}};function be(t,e,i){return Rn[e.curve](t.value,e.value,t.time,e.time,i,t.duration)}function Ht(t,e,i){var o=t[e];return o.curve==="target"?Rn.target(Ht(t,e-1,o.time),o.value,0,o.time,i,o.duration):o.value}function Fo(t,e){for(var i=t.length;t[--i]&&t[i].time>=e;);var o=t[i],r=t[i+1];if(!o)return 0;if(!r)return Ht(t,i,e);if(r.time===e){for(;t[++i]&&t[i].time===e;);return Ht(t,i-1,e)}if(e<r.time)return r.curve==="linear"||r.curve==="exponential"?be(o,r,e):Ht(t,i,e)}function dt(t,e){var i=mt(t);return!i||i.length===0?t.value:Math.fround(Fo(i,e))}var et=!1;function Se(t,e,i,o){i&&i.setValueAtTime||(t[e]&&t[e].setValueAtTime?(et&&ye("param",e+":",i),mt(t[e]).length=0,Gn(t,e,t.context.currentTime,"step",i,null,o)):t[e]&&t[e].connect?Do(t[e],i):(et&&ye("prop",e+" =",i),t[e]=i))}function Do(t,e,i,o){et&&ht("assign",t.constructor.name,i?Object.keys(i).join(", "):"");let r={};if(i)for(let s in i)o&&o.indexOf(s)>-1||i[s]&&i[s].setValueAtTime||t.hasOwnProperty(s)&&i[s]!==void 0&&(Se(t,s,i[s]),r[s]=!0);for(let s in e)o&&o.indexOf(s)>-1||r[s]||Se(t,s,e[s]);et&&ft()}function zn(t,e,i){et&&ht("assign",t.constructor.name,e?Object.keys(e).join(", "):"");var o;for(o in e)i&&i.indexOf(o)>-1||e[o]&&e[o].setValueAtTime||(t[o]||t.hasOwnProperty(o))&&e[o]!==void 0&&Se(t,o,e[o]);return et&&ft(),t}var Vo=Object.assign,Wn=Object.defineProperties,Ho=Object.getOwnPropertyDescriptor,_n=x.targetDurationFactor,jo={attack:{writable:!0,enumerable:!0},release:{writable:!0,enumerable:!0},gain:{writable:!0,enumerable:!0},rate:{writable:!0,enumerable:!0}},Io={attack:[[.008,"linear",1]],release:[[.008,"linear",0]],offset:0,gain:1,rate:1};function Un(t,e,i,o,r){var s;Ee(t,i,"hold");for(s of e)jn(s),Ee(t,i+s[0]/r,s[1],s[2]*o,s[3])}var gt=class extends ConstantSourceNode{constructor(e,i){super(e);super.start.call(this,e.currentTime),z.call(this,e),Wn(this,jo),zn(this,Vo({},Io,i))}start(e){if(!this.attack||this.attack.length===0)return this;z.prototype.start.apply(this,arguments),Un(this.offset,this.attack,this.startTime,this.gain,this.rate,"ConstantSource.offset");let i=K(this.attack);return i[2]===0&&(this.stopTime=e+(i[1]==="target"?i[0]+i[3]*_n:i[0])),this}stop(e){if(!this.release||this.release.length===0)return this;z.prototype.stop.apply(this,arguments);let i=dt(this.offset,this.stopTime);Un(this.offset,this.release,this.stopTime,i,this.rate,"ConstantSource.offset");let o=K(this.release);return o[2]!==0?(console.warn("Envelope.release does not end with value 0. Envelope will never stop.",this),this.stopTime=1/0):this.stopTime+=o[1]==="target"?o[0]+o[3]*_n:o[0],this}};Wn(gt.prototype,{playing:Ho(z.prototype,"playing")});var It=4,Go=[],Ro=[2,6];function Nn(t,e,i,o,r){let s=0;for(t.beginPath(),t.moveTo(e.x+s/i,e.y+(1-o[0])*e.height);++s<o.length;)t.lineTo(e.x+s/i,e.y+(1-o[s])*e.height);t.strokeStyle=r,t.lineWidth="2",t.lineCap="round",t.setLineDash(Go),t.stroke(),t.lineTo(e.x+e.width,e.y+e.height),t.lineTo(e.x,e.y+e.height),t.fillStyle=r+"2b",t.fill(),t.closePath()}function qn(t,e,i,o){let r=-1,s=18;for(t.beginPath();++r<i.length;)i[r].type==="target"&&(t.moveTo(e.x+i[r].x*e.width,e.y+(1-(i[r-1]?i[r-1].y:0))*e.height),t.lineTo(e.x+i[r].x*e.width,e.y+(1-i[r].y)*e.height+((i[r-1]?i[r-1].y:0)>i[r].y?-s:s)),t.moveTo(e.x+i[r].x*e.width+s,e.y+(1-i[r].y)*e.height),t.lineTo(e.x+(i[r+1]?i[r+1].x:1)*e.width,e.y+(1-i[r].y)*e.height));t.lineWidth="2",t.lineCap="round",t.strokeStyle=o,t.setLineDash(Ro),t.stroke(),t.closePath()}function Yn(t,e,i,o,r,s,u,l,p,h,f,m){let y=It*e.width/i.width,a=new OfflineAudioContext(1,It*e.width,22050),d=new gt(a,{attack:h.map(w=>w.type==="target"?[w.x*y/22050,w.type,w.y,w.duration*y/22050]:w.type?[w.x*y/22050,w.type,w.y]:[w.x*y/22050,"step",w.y])});return d.connect(a.destination),d.start(i.x,"attack"),d.stop(i.width),t.activeRenders=t.activeRenders?t.activeRenders+1:1,t.cacheddata&&Nn(t,e,It,t.cacheddata,f),t.cacheddata&&qn(t,e,h.map(w=>({x:o.normalise(r,s,w.x),y:u.normalise(l,p,w.y),type:w.type,duration:w.duration})).sort(ge(R("x"))),f),a.startRendering().then(w=>{if(--t.activeRenders)return;m();let F=w.getChannelData(0).map(D=>u.normalise(l,p,D));Nn(t,e,It,F,f),qn(t,e,h.map(D=>({x:o.normalise(r,s,D.x),y:u.normalise(l,p,D.y),type:D.type,duration:D.duration})).sort(ge(R("x"))),f),t.cacheddata=F})}var xe="linear";var Pe="any",ke="";function _o(t){t.stop()}function Uo(t,e){return t&&t.stop(),Ot(".",e)}function Jn(t,e,i,o,r,s){let u=Dt(t),l=V(e["font-size"]),p=V(e.borderLeftWidth)||0,h=V(e.borderTopWidth)||0,f=V(e.borderRightWidth)||0,m=V(e.borderBottomWidth)||0,y=V(e.paddingLeft)||0,a=V(e.paddingTop)||0,d=V(e.paddingRight)||0,w=V(e.paddingBottom)||0;return i.x=u.x+p+y,i.y=u.y+h+a,i.width=u.width-p-y-f-d,i.height=u.height-h-a-m-w,o.x=0,o.y=0,o.width=u.width-p-f,o.height=u.height-h-m,r.x=y,r.y=a,r.width=u.width-p-y-f-d,r.height=u.height-h-a-m-w,s.x=0,s.width=r.width/l,s.y=0,s.height=-r.height/l,u}function Wo(t,e,i,o,r,s){s.box=Jn(t,i,s.pxbox,s.paddingbox,s.contentbox,s.rangebox),o.width=s.paddingbox.width*2,o.height=s.paddingbox.height*2,e.setProperty("--range-x",s.rangebox.x),e.setProperty("--range-y",s.rangebox.y),e.setProperty("--range-width",s.rangebox.width),e.setProperty("--range-height",s.rangebox.height),r.setAttribute("viewBox",s.rangebox.x+" "+(s.rangebox.y+s.rangebox.height)+" "+s.rangebox.width+" "+-s.rangebox.height)}function No(t,e){let i=e.pxbox,o=e.valuebox,r=t.clientX-i.x-e.offset.x,s=i.height-(t.clientY-i.y-e.offset.y);e.x=it(o.x,o.x+o.width,H(o.x,o.x+o.width,r/i.width)),e.y=it(o.y,o.y+o.height,H(o.y,o.y+o.height,s/i.height))}var qo=v((t,e)=>e.type,{pointerdown:(t,e)=>{t.target=e.target,t.time=e.timeStamp/1e3,t.previous&&t.previous.type==="tap"&&t.time-t.previous.time<gn&&(t.type="double-tap",t.target=t.previous.target);let i=Dt(e.target);return t.offset=e.target===e.currentTarget?{x:0,y:0}:{x:e.clientX-(i.x+i.width/2),y:e.clientY-(i.y+i.height/2)},t.events.length=0,t.events.push(e),t},pointermove:(t,e)=>{t.events.push(e);let i=t.events[0];return e.timeStamp-i.timeStamp<oe&&e.clientX-i.clientX<4&&e.clientY-i.clientY<4||(t.type="move",No(e,t)),t},default:(t,e)=>(t.events.push(e),t.duration=e.timeStamp/1e3-t.time,!t.type&&t.duration<oe&&(t.type="tap"),t)}),Yo=te({".duration-handle":v((t,e)=>e.type,{pointermove:function(t,e){let i=H[e.yTransform](e.yMin,e.yMax,-e.y);return scope[3]=e.x<=scope[0]?minExponential:e.x-scope[0],scope[2]=i,e},default:P}),".control-handle":v((t,e)=>e.type,{tap:function(t,e){return e.scope=scope,e},"double-tap":function(t,e){let i=e.previous.scope;return ot(e.collection,i),e},move:function(t,e){let{internals:i,formdata:o,events:r,host:s,value:u,x:l,y:p}=e,h=t.dataset.index,f=Z(u[h]);return f.x=l,f.y=p,K(r).type!=="pointermove"?(An(i,o,s.name,u),Et("change",s)):Et("input",s),e},default:function(t){console.log("Untyped gesture",t)}}),"*":v((t,e)=>e.type,{"double-tap":function(t){let e=t.x,i=H[t.yTransform](t.yMin,t.yMax,-t.y);return insert(getTime,t.collection,[e,"step",i]),bn(t.collection,".",t.collection),t},default:P})});function Gt(t,e){let i=t.getPropertyValue(e).trim();return i==="none"?void 0:i}function Oe(t,e,i,o,r,s,u,l,p=!0){let h={x:o.x*2,y:o.y*2,width:o.width*2,height:o.height*2},f=Gt(i,"--line-color-x"),m=Gt(i,"--line-color-y"),y=Gt(i,"--crosshair-color"),a=Gt(i,"--envelope-color");Ln(e,{x:0,y:0,width:t.width,height:t.height}),f&&Bn(e,h,s.ticks.filter(d=>r.x+r.width>=d.value&&d.value>=r.x).map(d=>d.normalValue),f),m&&Cn(e,h,u.ticks.filter(d=>r.y+r.height>=d.value&&d.value>=r.y).map(d=>d.normalValue),m),y&&l&&l.length&&l.forEach(d=>Mn(e,h,28,{x:s.scale.normalise(s.min,s.max,d.x),y:u.scale.normalise(u.min,u.max,d.y)},y)),a&&p&&l&&l.length&&Yn(e,h,r,s.scale,s.min,s.max,u.scale,u.min,u.max,l,a,()=>Oe(t,e,i,o,r,s,u,l,!1))}function Xo(t,e,i){return t.push(C("label",{part:i+"-tick tick",style:"--normal-"+i+": "+e.normalValue+";",html:"<span>"+e.label+"</span>"})),t}function Qn(t,e,i,o,r,s,u,l,p,h){t.setAttribute("transform","translate("+H(e.x,e.x+e.width,i.normalise(o,r,p.x))+" "+H(e.y,e.y+e.height,s.normalise(u,l,p.y))+")"),t.firstElementChild.innerHTML=(p.label?p.label+" ":"")+p.x+", "+p.y,t.dataset.index=h}function $o(t,e,i,o,r,s,u,l,p){return C("path",{part:"handle",class:"control control-handle control-point",d:"M 0 0, m -0.5 0, a 0.5 0.5 0 1 0 1 0, a 0.5 0.5 0 1 0 -1 0",transform:"translate("+H(t.x,t.x+t.width,e.normalise(i,o,l.x))+" "+H(t.y,t.y+t.height,r.normalise(s,u,l.y))+")",html:"<title>"+(l.label?l.label+" ":"")+l.x+", "+l.y+"</title>",data:{index:p}})}function Ko(t,e,i,o,r,s){let u=-1,l,p;for(;l=s[++u];)t[u]?(p=t[u],Qn(p,i,o.scale,o.min,o.max,r.scale,r.min,r.max,l,u)):(p=$o(i,o.scale,o.min,o.max,r.scale,r.min,r.max,l,u),t.push(p),e.append(p));for(--u;p=t[++u];)p.remove()}function Kn(t,e,i,o,r,s,u,l,p){e.setProperty("--"+t+"-normal-zero",i.normalise(o,r,0)),l.forEach(h=>h.remove()),l.length=0,l=s.reduce((h,f)=>Xo(h,f,t),l),p.after.apply(p,l)}var Zn={construct:function(t,e){let i=C("style",":host {} :host > * { visibility: hidden; }"),o=C("label",{for:"input",html:"<slot></slot>",part:"label"}),r=C("canvas"),s=C("svg"),u=C("text",""),l=C("text",""),p=[],h=[],f=[],m=[],y=[];t.append(i,o,r,s,u,l);let a=L(this),d={value:[]},w=getComputedStyle(this),F=i.sheet.cssRules[0].style,D=i.sheet.cssRules[1].style,nt=r.getContext("2d"),zt=new FormData;a.host=this,a.hostStyle=F,a.childStyle=D,a.internals=e,a.data=d,a.ctx=nt,a.formdata=zt,a.shadow=new Promise(g=>a.load=g),a.pxbox={},a.paddingbox={},a.contentbox={},a.rangebox={x:0,y:6.75,width:6.75,height:-6.75},a.valuebox={x:0,y:0,width:1,height:1},a.xscale=c.of(xe),a.xmin=c.of(0),a.xmax=c.of(1),a.xstep=c.of(Pe),a.xticks=c.of(null),a.xdisplay=c.of(ke),a.yscale=c.of(xe),a.ymin=c.of(0),a.ymax=c.of(1),a.ystep=c.of(Pe),a.yticks=c.of(null),a.ydisplay=c.of(ke),a.value=c.of([{x:0,y:0,type:"step"}]);let _t=c.merge(a.shadow,ee("resize",window)).broadcast();_t.each(()=>Wo(this,F,w,r,s,a));let Ut=c.combine({shadow:a.shadow,scale:a.xscale.map(se),min:a.xmin.map(M),max:a.xmax.map(M),ticks:a.xticks.map($),step:a.xstep,display:a.xdisplay}).scan(ie,{}).broadcast(),Wt=c.combine({shadow:a.shadow,scale:a.yscale.map(se),min:a.ymin.map(M),max:a.ymax.map(M),ticks:a.yticks.map($),step:a.ystep,display:a.ydisplay}).scan(ie,{}).broadcast();Ut.each(g=>{a.valuebox.x=g.min,a.valuebox.width=g.max-g.min}),Wt.each(g=>{a.valuebox.y=g.min,a.valuebox.height=g.max-g.min}),Ut.each(g=>Kn("x",F,g.scale,g.min,g.max,g.ticks,p,f,u)),Wt.each(g=>Kn("y",F,g.scale,g.min,g.max,g.ticks,h,m,l));let Be=a.value.scan(Uo,null).flatMap(b).broadcast();c.combine({xaxis:Ut,yaxis:Wt,resizes:_t,value:Be}).each(g=>{a.state=g,Oe(r,nt,w,a.contentbox,a.valuebox,g.xaxis,g.yaxis,g.value),Ko(y,s,a.rangebox,g.xaxis,g.yaxis,g.value)}),a.valueObservers=Be.reduce((g,ei)=>(g.forEach(_o),g.push.apply(g,ei.map((Ce,Me,ni)=>Ot(".",Ce,Ce).each(ii=>{let oi=s.querySelectorAll("[part=handle]")[Me];Oe(r,nt,w,a.contentbox,a.valuebox,a.state.xaxis,a.state.yaxis,ni),Qn(oi,a.rangebox,a.state.xaxis.scale,a.state.xaxis.min,a.state.xaxis.max,a.state.yaxis.scale,a.state.yaxis.min,a.state.yaxis.max,ii,Me)}))),g),[]),me({select:"[part=handle]",threshold:1},t).each(g=>{Jn(this,w,a.pxbox,a.paddingbox,a.contentbox,a.rangebox),g.scan(qo,{handles:y,internals:e,host:this,pxbox:a.pxbox,valuebox:a.valuebox,formdata:a.formdata,value:a.state.value,events:[]}).filter(R("type")).each(Yo)})},load:function(t){let e=L(this);e.childStyle.visibility="",e.load(t)}};function Jo(t,e){let i=t[t.length-1];return i&&i.y===void 0?i.y=M(e):i&&i.type==="target"&&i.duration===void 0?i.duration=M(e):i&&!/^-?\d/.test(e)?i.type=e:t.push({x:M(e)}),t}function Ae(t){return t.split(/\s*,\s*|\s+/).reduce(Jo,[])}function Qo(t){return t.x+" "+t.y+(t.label?" "+t.label:"")}function Le(t){return t.map(Qo).join(", ")}function N(t,e){return{attribute:function(i){L(this)[t].push(i||e)}}}function Rt(t,e){return{attribute:function(i){this[t]=i},set:function(i){L(this)[t].push(i===void 0?e:i)},get:function(){return L(this).data[t]},enumerable:!0}}function Zo(t){return{attribute:function(e){L(this)[t].push(!!e)}}}var ti={xmin:Rt("xmin",0),xmax:Rt("xmax",1),ymin:Rt("ymin",0),ymax:Rt("ymax",1),xscale:N("xscale","linear"),yscale:N("yscale","linear"),xticks:N("xticks",""),yticks:N("yticks",""),xstep:N("xstep"),ystep:N("ystep"),xdisplay:N("xdisplay"),ydisplay:N("ydisplay"),valuebox:{attribute:function(t){}},ordered:Zo("ordered"),value:{attribute:function(t){this.value=t},get:function(){let t=L(this);return Le(t.state.value)},set:function(t){L(this).value.push(typeof t=="string"?Ae(t):J(t))},enumerable:!0},data:{get:function(){let t=L(this);return Z(t.state.value)},set:function(t){L(this).value.push(J(t))},enumerable:!0}};var tr=window.xyInputStylesheet||import.meta.url.replace(/\/[^\/]*([?#].*)?$/,"/")+"shadow.css",Za=Xt("<xy-input>",Zn,ti,tr);export{Za as default};
